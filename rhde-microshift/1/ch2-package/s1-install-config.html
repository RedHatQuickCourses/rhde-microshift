<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Install and Configure MicroShift on Package-Based RHEL :: Deploying MicroShift on Red Hat Device Edge</title>
    <link rel="prev" href="index.html">
    <link rel="next" href="s2-install-lab.html">
    <meta name="generator" content="Antora 3.1.3">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.redhat.com" target="_blank"><img src="../../../_/img/redhat-logo.png" height="40px" alt="Red Hat"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="../../..">Deploying MicroShift on Red Hat Device Edge</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/RedHatQuickCourses/rhde-microshift/issues" target="_blank">Report Issues</a>
      </div>
    </div>
  </nav>
</header><div class="body">
<div class="nav-container" data-component="rhde-microshift" data-version="1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Deploying MicroShift on Red Hat Device Edge</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Home</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../ch1-microshift/index.html">Introduction to Red Hat Build of MicroShift</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">Deploy MicroShift on RHEL Servers</a>
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="s1-install-config.html">Install and Configure MicroShift on Package-Based RHEL</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="s2-install-lab.html">Lab: Install MicroShift from RPM Packages</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="s3-access-lab.html">Lab: Access MicroShift as a Developer or Platform Engineer</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="s4-apps-lab.html">Lab: Deploy Kubernetes Applications in MicroShift</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../ch3-image/index.html">Deploy MicroShift on Edge Devices</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Deploying MicroShift on Red Hat Device Edge</span>
    <span class="version">1</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">Deploying MicroShift on Red Hat Device Edge</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../samples/1/index.html">samples</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../samples/1/index.html">1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Deploying MicroShift on Red Hat Device Edge</a></li>
    <li><a href="index.html">Deploy MicroShift on RHEL Servers</a></li>
    <li><a href="s1-install-config.html">Install and Configure MicroShift on Package-Based RHEL</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Install and Configure MicroShift on Package-Based RHEL</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><em>Estimated reading time: <strong>9 minutes</strong>.</em></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Objective</dt>
<dd>
<p>Install MicroShift in RHEL and Configure it with basic Storage, Networking, and Security</p>
</dd>
</dl>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Work In Progress
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_day_1_day_2_and_day_to_day_operation_of_microshift"><a class="anchor" href="#_day_1_day_2_and_day_to_day_operation_of_microshift"></a>Day 1, Day 2, and Day to Day Operation of MicroShift</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The previous chapter focused on the Red Hat build of MicroShift as a product: how it relates to Red Hat OpenShift and to upstream Kubernetes by means of which components and features are included. This chapter switches focus to using MicroShift and how it differs from using Red Hat OpenShift.</p>
</div>
<div class="paragraph">
<p>The following table provides a quick comparision between tools and tasks using MicroShift and Red Hat OpenShift.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Task or Tool</th>
<th class="tableblock halign-left valign-top">Red Hat Build of MicroShift</th>
<th class="tableblock halign-left valign-top">Red Hat OpenShift</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Host OS</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Red Hat Enterprise Linux, image mode or package mode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Red Hat Enterprise Linux CoreOS</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Installation Method</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">RPM packages</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OpenShift installer and variations (ex: assisted installer)</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Update Method</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">RPM packages</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OpenShift Cluster Vesion Operator (CVO)</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Configuration</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Custom resources of OpenShift cluster operators</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MicroShift configuration files</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Authentication</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trusted TLS certificates or bearer tokens embedded in a Kubeconfig file</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Local users from OpenShift OAuth or remote users from an OpenShift OAuth Identity Provider</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Developer Workflow</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Namespaces pre-provisioned by a cluster administrator</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Self-service project creation</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Graphical or Web UI</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OpenShift Web Console</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Command-Line access</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">OpenShift CLI (<code>oc</code>) or Kubernetes client (<code>kubectl</code>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OpenShift CLI (<code>oc</code>) or Kubernetes client (<code>kubectl</code>)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Once you have a MicroShift cluster ready for your work, deploying and managing Kubernetes applications is basically the same as with Red Hat OpenShift and other Kubernetes: you create and change application resources such as Deployments, Secrets, and Services. Container images and Kubernetes manifes from applications which work on Red Hat OpenShift are expected to work unchanged on MicroShift, as long as they do not require custom resources from add-on operators that are not available on their MicroShift instances.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_when_to_use_microshift_with_package_based_rhel"><a class="anchor" href="#_when_to_use_microshift_with_package_based_rhel"></a>When to Use MicroShift with Package-Based RHEL</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Red Hat recommends that production deployments of MicroShift use RHEL for Edge images, which include MicroShift and applications preinstalled and preconfigured, already embeded on system images. So why are we focusing here on deploying MicroShift using traditional RHEL, as a package-based operating system deployment? There are two reasons:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>It&#8217;s easier to learn the configuration of MicroShift in a package-based system, where you can quickly perform and test individual configurations, instead of having it all done at once as part of an Image Builder blueprint and having the overhead of building an entire new system image to address configuration changes.</p>
</li>
<li>
<p>Developer testing, and sometimes light integration testing (from a CI/CD pipeline), could be quickier and easier with a preconfigured package-based system than from building a new system image and booting a new system or VM from it.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This course uses package-based RHEL to practice skills required to configure and troubleshoot MicroShift instances, so later you can be confident when deploying MicroShift with RHEL for Edge images.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_before_you_install_microshift"><a class="anchor" href="#_before_you_install_microshift"></a>Before You Install MicroShift</h2>
<div class="sectionbody">
<div class="paragraph">
<p>MicroShift was designed to be an easy addition over standard RHEL, so keep SELinux, Firewalld, and Network Manager enabled. The more you diverge from RHEL defaults, the harder it might be to get MicroShift up and running. It is designed to work integrated with oter system services from RHEL.</p>
</div>
<div class="paragraph">
<p>The majority of MicroShift deployments require LVM to back persistent storage for Kubernetes persistent volumes. You need a volume group (VG) named <code>rhel</code> with sufficient empty space for MicroShift to create logical volumes (LVs) for each of your application&#8217;s persistent volumes.</p>
</div>
<div class="paragraph">
<p>If your main work machine runs RHEL, you could install and configure MicroShift on it, but because your work machine probably runs a variety of other system services, it&#8217;s recommended that you install MicroShift in a dedicated virtual machine or remote system. Local, unprivileged session VMs from Libvirt or any other desktop hypervisor should work well.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_install_and_configure_microshift"><a class="anchor" href="#_install_and_configure_microshift"></a>Install and Configure MicroShift</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To install MicroShift, you need two RPM repositories:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>rhocp-4.17-for-rhel-9-x86_64-rpms</code></dt>
<dd>
<p>Red Hat OpenShift Container Platform 4.17</p>
</dd>
<dt class="hdlist1"><code>fast-datapath-for-rhel-9-x86_64-rpms</code></dt>
<dd>
<p>RHEL 9 Fast Data Path</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Change the names of the repositories above according to your RHEL release and the CPU architecture of your target system.  The first provides the MicroShift RPM packages, which are built together with each release of Red Hat OpenShift. The second provides Open Virtual Network (OVN) packages which are required by MicroShift&#8217;s virtual pod and service network.</p>
</div>
<div class="paragraph">
<p>You also need a pull secret which gives access to container images from Red Hat container registries and Quay.io. It could be the pull secret from a free Red Hat Developer account, which provides you with access to RHEL installation media, RHEL package repositories, and also selected Red Hat software such as Red Hat OpenShift.</p>
</div>
<div class="paragraph">
<p>If you perform an air-gapped installation of MicroShift, you need a mirror of those two package repositories, in addition to the standard RHEL BaseOS and AppStream repositories, which you need to satisfy package dependencies. You also need a mirror container registry pre-populared with the container images required by MicroShift and add-on operators that you install, besides a pull secret configured for that mirror registry.</p>
</div>
<div class="paragraph">
<p>You could use, as installation source for an air-gapped deployment, any software capable of serving DNF repositories, such as Red Hat Satellite, in addition to any OCI-compliant container registry server, such as Red Hat Quay.</p>
</div>
<div class="paragraph">
<p>Other than the pull secret, you shouldn&#8217;t need to make edits to any of the MicroShift configuration files: they have reasonable defaults for starting a MicroShift instance. But if you deploy MicroShift air-gapped, you also need to provide an image policy configuration file which redirects access to the Red Hat registries and Quay.io to your mirror registry.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_acess_microshift_with_administrator_rights"><a class="anchor" href="#_acess_microshift_with_administrator_rights"></a>Acess MicroShift With Administrator Rights</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When you start MicroShift, it generates kubeconfig files in the <code>/var/lib/microshift/resources/kubeadmin/</code> directory, which also embed the public key of the internal certificate authority (CA) of the cluster, so you can access your MicroShift instance and keep TLS certificate validation on. One file matches the <code>localhost</code> host name and IP address. Other files match the hostname configured on the machine and additional alternate names set in the MicroShift configuration files.</p>
</div>
<div class="paragraph">
<p>You could copy the kubeconfig file for the public hostname of your MicroShift instance to any computer and open the Kubernetes API port on the system firewall, then access MicroShift with full cluster administrator rights. Red Hat recommends that you store that kubeconfig file in a secure location, for emergency usage, as in a "break-the-glass" scenario, and refraim from using it for day-to-day access to MicroShift. Instead, Red Hat recommends that you create kubeconfig files which grant only limited privileges on selected namespaces, for day-to-day usage.</p>
</div>
<div class="paragraph">
<p>Even for the team responsible for managing MicroShift instances, Red Hat recommends that you create individual kubeconfig files for each team member, so that you can audit which user performed which action, and grant these users Kubernetes impersonation rights to perform cluster administration tasks. This is similar to requiring RHEL system administrators to use their own user accounts and <code>sudo</code> for performing system administration tasks.</p>
</div>
<div class="paragraph">
<p>Kubernetes Kubeconfig files can store user credentials and CA certificates for multiple different clusters in a single file, but we find it easier to keep multiple Kubeconfig files, one for each MicroShift (or Red Hat OpenShift) instance, and alternate between files using the <code>--kubeconfig</code> option or the <code>KUBECONFIG</code> environment variable.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_access_microshoft_with_developer_rights"><a class="anchor" href="#_access_microshoft_with_developer_rights"></a>Access MicroShoft with Developer Rights</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Developers used to Red Hat OpenShift will perceive significant differences in their regular workflows. Because MicroShift lacks the OpenShift OAuth server and the Projects extension API, the following OpenShift CLI commands cannot work with MicroShift instances:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>oc login</code></p>
</li>
<li>
<p><code>oc new-project</code></p>
</li>
<li>
<p><code>oc project <em>name-of-project</em></code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You should also avoid <code>oc</code> commands which require other OpenShift extension APIs missing in MicroShift, such as Image Streams and Build Configs.</p>
</div>
<div class="paragraph">
<p>Even with the missing extension APIs, the OpenShift CLI still provides a number of niceties for MicroShift users compared to the Kubernetes client and Red Hat recommend using the <code>oc</code> command with MicroShift. If you prefer not using these niceties, the <code>kubectl</code> command is also supported, for MicroShift and also all editions of Red Hat OpenShift.</p>
</div>
<div class="paragraph">
<p>MicroShift is <em>not</em> an application platform, it is just a Kubernetes engine. It does not provide self-service project creation and require that a cluster administrator create and configure namespaces for regular users, who chan they deploy applications.</p>
</div>
<div class="paragraph">
<p>Unprivileged users of MicroShift require credentials for one of the authentication mechanisms supported by upstream Kuberentes:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>TLS client certificates</p>
</li>
<li>
<p>Service account tokens</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Red Hat recommends the second because Kubernetes does not include management of certificate revocation lists. That means you cannot un-authorize a client certificate that leaks to unauthorized users, but you can delete a service account resource to invalidate its token.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The autogenerate kubeconfig files for cluster administration use client certificates, so handle them with care, and do not share them. If you need to revoke such certificates, you need to refresh the internal Kubernetes CA of its MicroShift instance, which invalidates all client certitficates for that instance.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once you have authentication credentials for an unprivileged user, a cluster administrator uses standard Kubernetes Role-Based Access Control (RBAC) to grant rights to manage kubernetes resources in one or more namespaces. You could use the standard <code>admin</code>, <code>edit</code>, and <code>view</code> cluster roles from Kubernetes or create your own cluster roles or namespace roles.</p>
</div>
<div class="paragraph">
<p>Most developers only need the <code>edit</code> cluster role, which grants permission to manage common application resourcesm, such as deployments and persistent volume claims. Selected users may be granted the <code>admin</code> cluster roles, which adds over the <code>edit</code> role rights to manage policy resources, such as resource quotas and network policies.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_whats_next"><a class="anchor" href="#_whats_next"></a>What&#8217;s Next</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now that you got an overview of what&#8217;s required to install, configure, and access MicroShift clusters, there&#8217;s a sequence of activities which install MicroShift, check its healthy, configures access for developes, and deploy simple test applications to verify storage and networking resources of a MicroShift instance.</p>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="index.html">Deploy MicroShift on RHEL Servers</a></span>
  <span class="next"><a href="s2-install-lab.html">Lab: Install MicroShift from RPM Packages</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <img src="../../../_/img/rhl-logo-red.png" height="40px" alt="Red Hat"  href="https://redhat.com" >
</footer><script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
